---
title: Anthropic
description: Integration with Anthropic's Claude models, supporting completion models with advanced features like tool usage and prompt caching.
---

import { Cards } from 'nextra/components'

# Anthropic Integration

The Anthropic provider in Rig offers integration with Anthropic's Claude models, supporting completion models with advanced features like tool usage and prompt caching.

## Basic Usage
To use the Anthropic module, make sure `rig-core` is added as a dependency to your Rust project (alongside `tokio` with the `macros` and `rt-multi-thread` for the purposes of the example if you want to run the code below). Then you can simply import the Anthropic provider and use it as below.

> **Note**: Make sure your environment variable `ANTHROPIC_API_KEY` is set before running the example code.

```rust
use std::env;

use rig::{
    completion::Prompt,
    providers::anthropic::{self, CLAUDE_3_5_SONNET},
};

#[tokio::main]
async fn main() -> Result<(), anyhow::Error> {
    // Create Anthropic client
    let client = anthropic::ClientBuilder::new(
        &env::var("ANTHROPIC_API_KEY").expect("ANTHROPIC_API_KEY not set"),
    )
    .build();

    // Create agent with a single context prompt
    let agent = client
        .agent(CLAUDE_3_5_SONNET)
        .preamble("Be precise and concise.")
        .temperature(0.5)
        .build();

    // Prompt the agent and print the response
    let response = agent
        .prompt("When and where and what type is the next solar eclipse?")
        .await?;
    println!("{}", response);

    Ok(())
}
```

## Available Models
Below is a list of available models that have been added as const variables to the provider module. If there is a supported model you would like to use but is not provided below, you can simply use a string literal instead.

### Completion Models
- `CLAUDE_3_OPUS`: Most capable model
- `CLAUDE_3_SONNET`: Balanced performance and speed
- `CLAUDE_3_HAIKU`: Fastest, most efficient model
- `CLAUDE_3_5_SONNET`: Latest Sonnet version

## Supported Features

### Messages API (Completions)
The `anthropic` module supports use of [Anthropic's Messages API](https://docs.anthropic.com/en/api/messages), which follows the Chat Completion API set by OpenAI.

### Tool usage
Anthropic also additionally supports tool usage. To create your own tool, you can find out more [here.](/docs/4_concepts/2_tools)


## Special Considerations

### API Versioning
Anthropic requires explicit version specification. During regular usage, this will be automatically set to [the latest version](https://github.com/0xPlaygrounds/rig/blob/main/rig-core/src/providers/anthropic/client.rs#L35) for you. However, the API versions have additionally been provided in the Anthropic module should you need to change the version you're using. You can find more about this [in the completion sub-module.](https://github.com/0xPlaygrounds/rig/blob/main/rig-core/src/providers/anthropic/completion.rs#L35)


### Max token required to be set
Unlike other providers, Anthropic requires `max_tokens` to be set. The default for this has been set to 8192 for 3.5 Sonnet and 3.5 Haiku, and 4096 for the Claude 3 models. Should you want to change the max tokens allowed however (for example, for token usage reasons) then you can easily change it:

```rust
// Create agent with a single context prompt
let agent = client
    .agent(CLAUDE_3_5_SONNET)
    .preamble("Be precise and concise.")
    .temperature(0.5)
	.max_tokens(1024)
    .build();
```

### In-depth responses
Anthropic responses include detailed token usage information including cache statistics. You can find out more about this [here.](https://github.com/0xPlaygrounds/rig/blob/main/rig-core/src/providers/anthropic/completion.rs#L64)


### Multiple content response types
Anthropic additionally supports multiple content response types. You can check out the example below for more information.

```rust filename="rig-core/src/providers/anthropic/completion.rs [43:58]"
}

#[derive(Debug, Deserialize, Serialize)]
#[serde(untagged)]
pub enum Content {
    String(String),
    Text {
        r#type: String,
        text: String,
    },
    ToolUse {
        r#type: String,
        id: String,
        name: String,
        input: serde_json::Value,
    },
```

<br />

<Cards>
<Cards.Card title="Anthropic API Reference" href="https://docs.anthropic.com/en/api/getting-started"/>
<Cards.Card title="API Reference (docs.rs)" href="https://docs.rs/rig-core/latest/rig/providers/anthropic/index.html"/>
</Cards>
